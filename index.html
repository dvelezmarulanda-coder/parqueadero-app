<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de Gesti√≥n de Parqueadero - Profesional y Minimalista">
    <title>Gesti√≥n de Parqueadero</title>

    <!-- Styles -->
    <link rel="stylesheet" href="./parking-styles.css">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üÖøÔ∏è</text></svg>">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="header-title">üÖøÔ∏è Gesti√≥n de Parqueadero</h1>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                <span class="theme-icon">üåô</span>
            </button>
        </div>
        <p class="header-subtitle">Sistema profesional de control vehicular</p>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-view="registro" data-icon="‚ûï">Nuevo</button>
            <button class="nav-btn" data-view="dashboard" data-icon="üìä">Dashboard</button>
            <button class="nav-btn" data-view="reportes" data-icon="üìà">Reportes</button>
            <button class="nav-btn" data-view="admin" data-icon="‚öôÔ∏è">Admin</button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Dashboard View -->
        <div id="dashboard" class="view">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Veh√≠culos Actuales</div>
                    <div class="stat-value" id="stat-current">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Espacios Libres</div>
                    <div class="stat-value" id="stat-free">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Recaudo Diario</div>
                    <div class="stat-value" id="stat-revenue">$0</div>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="card" style="padding: 1rem; margin-bottom: 1rem;">
                <div class="form-group" style="margin-bottom: 0;">
                    <input type="text" id="search-input" class="form-input"
                        placeholder="üîç Buscar por placa o nombre..." autocomplete="off">
                </div>
            </div>

            <!-- Active Tickets -->
            <div class="card">
                <h2 class="card-title">Tickets Activos</h2>
                <div id="active-tickets" class="tickets-list">
                    <!-- Tickets will be loaded here -->
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Cargando tickets...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registro View -->
        <div id="registro" class="view active">
            <div class="card">
                <h2 class="card-title">Registrar Nuevo Veh√≠culo</h2>

                <form id="registro-form" class="form">
                    <!-- Placa -->
                    <div class="form-group">
                        <label class="form-label" for="placa">Placa del Veh√≠culo</label>
                        <input type="text" id="placa" class="form-input" placeholder="ABC123" required
                            autocomplete="off">
                    </div>

                    <!-- Nombre Cliente -->
                    <div class="form-group">
                        <label class="form-label" for="nombre">Nombre del Cliente</label>
                        <input type="text" id="nombre" class="form-input" placeholder="Juan P√©rez" required
                            autocomplete="off">
                    </div>

                    <!-- Celular -->
                    <div class="form-group">
                        <label class="form-label" for="celular">Celular</label>
                        <input type="tel" id="celular" class="form-input" placeholder="3001234567" required
                            autocomplete="off">
                    </div>

                    <!-- Tipo de Veh√≠culo -->
                    <div class="form-group">
                        <label class="form-label">Tipo de Veh√≠culo</label>
                        <div class="vehicle-selector">
                            <div class="vehicle-option">
                                <input type="radio" id="tipo-carro" name="tipo_vehiculo" value="carro" required>
                                <label for="tipo-carro" class="vehicle-option-label">
                                    <div class="vehicle-icon">üöó</div>
                                    <div class="vehicle-name">Carro</div>
                                </label>
                            </div>
                            <div class="vehicle-option">
                                <input type="radio" id="tipo-moto" name="tipo_vehiculo" value="moto" required>
                                <label for="tipo-moto" class="vehicle-option-label">
                                    <div class="vehicle-icon">üèçÔ∏è</div>
                                    <div class="vehicle-name">Moto</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Tipo de Tarifa -->
                    <div class="form-group">
                        <label class="form-label">Tipo de Tarifa</label>
                        <div class="rate-selector">
                            <div class="rate-option">
                                <input type="radio" id="rate-hour" name="rate_type" value="hour" checked>
                                <label for="rate-hour" class="rate-option-label">
                                    <div class="rate-icon">‚è±Ô∏è</div>
                                    <div class="rate-name">Por Hora</div>
                                </label>
                            </div>
                            <div class="rate-option">
                                <input type="radio" id="rate-day" name="rate_type" value="day">
                                <label for="rate-day" class="rate-option-label">
                                    <div class="rate-icon">üìÖ</div>
                                    <div class="rate-name">Por D√≠a</div>
                                </label>
                            </div>
                            <div class="rate-option">
                                <input type="radio" id="rate-month" name="rate_type" value="month">
                                <label for="rate-month" class="rate-option-label">
                                    <div class="rate-icon">üìÜ</div>
                                    <div class="rate-name">Por Mes</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Puesto -->
                    <div class="form-group">
                        <label class="form-label" for="puesto">Puesto de Parqueo</label>
                        <input type="text" id="puesto" class="form-input" placeholder="A-01" required
                            autocomplete="off">
                    </div>

                    <!-- Fecha Ingreso -->
                    <div class="form-group">
                        <label class="form-label" for="fecha-ingreso">Fecha y Hora de Ingreso</label>
                        <input type="datetime-local" id="fecha-ingreso" class="form-input" required>
                    </div>

                    <!-- Fecha Salida Estimada -->
                    <div class="form-group">
                        <label class="form-label" for="fecha-salida">Fecha y Hora de Salida Estimada</label>
                        <input type="datetime-local" id="fecha-salida" class="form-input" required>
                    </div>

                    <!-- Total -->
                    <div class="form-group">
                        <label class="form-label" for="total">Total a Pagar (COP)</label>
                        <input type="number" id="total" class="form-input" readonly>
                        <small class="form-help">El total se calcula autom√°ticamente seg√∫n el tipo de veh√≠culo y tarifa
                            seleccionada</small>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary btn-block">
                        ‚úÖ Registrar Veh√≠culo
                    </button>
                </form>

                <!-- Success/Error Messages -->
                <div id="registro-message" class="mt-2"></div>
            </div>
        </div>

        <!-- Reportes View -->
        <div id="reportes" class="view">
            <div class="card">
                <h2 class="card-title">Reportes e Hist√≥rico</h2>

                <!-- Filters -->
                <div class="filters">
                    <div class="form-group">
                        <label class="form-label" for="filter-desde">Desde</label>
                        <input type="date" id="filter-desde" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="filter-hasta">Hasta</label>
                        <input type="date" id="filter-hasta" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="filter-estado">Estado de Pago</label>
                        <select id="filter-estado" class="form-select">
                            <option value="todos">Todos</option>
                            <option value="pagado">Pagado</option>
                            <option value="pendiente">Pendiente</option>
                        </select>
                    </div>
                </div>

                <div class="ticket-actions">
                    <button id="btn-aplicar-filtros" class="btn btn-primary">üîç Aplicar Filtros</button>
                    <button id="btn-exportar-pdf" class="btn btn-success">üìÑ Exportar a PDF</button>
                </div>

                <!-- Summary Stats -->
                <div id="report-summary" class="mt-2"></div>

                <!-- Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Placa</th>
                                <th>Cliente</th>
                                <th>Tipo</th>
                                <th>Puesto</th>
                                <th>Ingreso</th>
                                <th>Salida Est.</th>
                                <th>Total</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="reportes-tbody">
                            <tr>
                                <td colspan="8" class="text-center">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>Cargando reportes...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Admin View -->
        <div id="admin" class="view">
            <div class="card">
                <h2 class="card-title">‚öôÔ∏è Panel de Administraci√≥n</h2>

                <!-- Configuration Section -->
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--color-dark-gray); margin-bottom: 1rem;">Configuraci√≥n del Parqueadero</h3>

                    <div class="form">
                        <div class="form-group">
                            <label class="form-label" for="admin-total-spaces">Espacios Totales</label>
                            <input type="number" id="admin-total-spaces" class="form-input" min="1" value="50">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-car-rate">Tarifa por Hora - Carro (COP)</label>
                            <input type="number" id="admin-car-rate" class="form-input" min="0" step="100" value="2500">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-moto-rate">Tarifa por Hora - Moto (COP)</label>
                            <input type="number" id="admin-moto-rate" class="form-input" min="0" step="100"
                                value="1500">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-car-day-rate">Tarifa por D√≠a - Carro (COP)</label>
                            <input type="number" id="admin-car-day-rate" class="form-input" min="0" step="1000"
                                value="20000">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-car-month-rate">Tarifa por Mes - Carro (COP)</label>
                            <input type="number" id="admin-car-month-rate" class="form-input" min="0" step="10000"
                                value="400000">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-moto-day-rate">Tarifa por D√≠a - Moto (COP)</label>
                            <input type="number" id="admin-moto-day-rate" class="form-input" min="0" step="1000"
                                value="12000">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-moto-month-rate">Tarifa por Mes - Moto (COP)</label>
                            <input type="number" id="admin-moto-month-rate" class="form-input" min="0" step="10000"
                                value="250000">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="admin-warning-minutes">Alerta de Salida (minutos
                                antes)</label>
                            <input type="number" id="admin-warning-minutes" class="form-input" min="0" value="60">
                        </div>

                        <button id="btn-save-config" class="btn btn-primary btn-block">
                            üíæ Guardar Configuraci√≥n
                        </button>
                    </div>
                </div>

                <!-- Password Management Section -->
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--color-dark-gray); margin-bottom: 1rem;">üîê Seguridad</h3>

                    <div class="form">
                        <div class="form-group">
                            <label class="form-label" for="current-password">Contrase√±a Actual</label>
                            <input type="password" id="current-password" class="form-input"
                                placeholder="Ingresa tu contrase√±a actual" autocomplete="current-password">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="new-password">Nueva Contrase√±a</label>
                            <input type="password" id="new-password" class="form-input"
                                placeholder="M√≠nimo 6 caracteres" minlength="6" autocomplete="new-password">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="new-password-confirm">Confirmar Nueva Contrase√±a</label>
                            <input type="password" id="new-password-confirm" class="form-input"
                                placeholder="Repite la nueva contrase√±a" minlength="6" autocomplete="new-password">
                        </div>

                        <div class="ticket-actions">
                            <button id="btn-change-password" class="btn btn-primary">
                                üîÑ Restablecer Cuenta Admin
                            </button>
                            <button id="btn-logout-admin" class="btn btn-danger">
                                üö™ Cerrar Sesi√≥n
                            </button>
                        </div>
                        <p
                            style="font-size: 0.8rem; color: var(--color-text-muted); margin-top: 0.5rem; text-align: center;">
                            * "Restablecer Cuenta" cerrar√° la sesi√≥n y te permitir√° registrar un nuevo correo y
                            contrase√±a en este dispositivo.
                        </p>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div style="margin-top: 3rem; padding-top: 2rem; border-top: 2px dashed #e74c3c;">
                    <h3 style="color: #e74c3c; margin-bottom: 1rem;">‚ö†Ô∏è Zona de Peligro</h3>
                    <p style="color: var(--color-text-muted); margin-bottom: 1rem;">
                        Estas acciones son irreversibles. Ten cuidado.
                    </p>
                    <button id="btn-factory-reset" class="btn btn-danger btn-block" style="background-color: #c0392b;">
                        üóëÔ∏è REINICIAR SISTEMA (BORRAR TODO)
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Admin Authentication Modal -->
    <div id="admin-auth-modal" class="modal-overlay" style="display: none;"
        onclick="if(event.target === this) this.style.display='none'">
        <div class="modal-content" style="position: relative;">
            <!-- Close Button -->
            <span onclick="document.getElementById('admin-auth-modal').style.display='none'"
                style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; color: var(--color-text-muted); font-weight: bold;">&times;</span>

            <!-- First-Time Setup Form -->
            <div id="admin-setup-form" style="display: none;">
                <h2 style="text-align: center; color: var(--color-text); margin-bottom: 1.5rem;">
                    üîê Configuraci√≥n Inicial de Admin
                </h2>
                <p style="text-align: center; color: var(--color-text-muted); margin-bottom: 2rem;">
                    Establece tu correo y contrase√±a para acceder al panel de administraci√≥n
                </p>

                <form id="setup-credentials-form" class="form">
                    <div class="form-group">
                        <label class="form-label" for="setup-email">Correo Electr√≥nico</label>
                        <input type="email" id="setup-email" class="form-input" placeholder="admin@ejemplo.com" required
                            autocomplete="email">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="setup-password">Contrase√±a</label>
                        <input type="password" id="setup-password" class="form-input" placeholder="M√≠nimo 6 caracteres"
                            required minlength="6" autocomplete="new-password">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="setup-password-confirm">Confirmar Contrase√±a</label>
                        <input type="password" id="setup-password-confirm" class="form-input"
                            placeholder="Repite la contrase√±a" required minlength="6" autocomplete="new-password">
                    </div>

                    <div id="setup-message" style="margin-bottom: 1rem;"></div>

                    <button type="submit" class="btn btn-primary btn-block">
                        üîí Establecer Contrase√±a
                    </button>
                </form>
            </div>

            <!-- Login Form -->
            <div id="admin-login-form" style="display: none;">
                <h2 style="text-align: center; color: var(--color-text); margin-bottom: 1.5rem;">
                    üîê Acceso al Panel de Admin
                </h2>

                <form id="login-credentials-form" class="form">
                    <div class="form-group">
                        <label class="form-label" for="login-email">Correo Electr√≥nico</label>
                        <input type="email" id="login-email" class="form-input" placeholder="admin@ejemplo.com" required
                            autocomplete="email">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="login-password">Contrase√±a</label>
                        <input type="password" id="login-password" class="form-input"
                            placeholder="Ingresa tu contrase√±a" required autocomplete="current-password">
                    </div>

                    <div id="login-message" style="margin-bottom: 1rem;"></div>

                    <button type="submit" class="btn btn-primary btn-block">
                        üîì Iniciar Sesi√≥n
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="debug_overlay.js"></script>
    <script src="./config.js"></script>
    <script src="./parking-logic.js?v=2"></script>
</body>

</html>